!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/js/",t(t.s=25)}([function(e,t,n){"use strict";function r(e,t){var n=i[e];if(!n)if(n={path:e},i[e]=n,"module"===t){var r=WebUtils.readFile(e),o=new Function("module",r);o(n)}else"text"===t?n.exports=WebUtils.readFile(e):window.eval(WebUtils.readFile(e));return n.exports}t.a=r;var i={}},function(e,t,n){"use strict";function r(e){var t=s.prototype.$modes;if(!t[e]){window.eval(WebUtils.readFile("vendor/ace/mode-"+e+".js"));var n=ace.require("ace/mode/"+e);t[e]=new n.Mode({inline:!0})}return t[e]}function i(e){var t=ace.require("ace/theme/"+e);return t||(window.eval(WebUtils.readFile("vendor/ace/theme-"+e+".js")),t=ace.require("ace/theme/"+e)),t||i("textmate")}t.b=r,t.a=i;var o=ace.require("ace/edit_session"),s=o.EditSession},function(e,t,n){"use strict";function r(e){var t=e.getBoundingClientRect();(t.top<0||t.top>window.innerHeight)&&(document.body.scrollTop+=t.top-window.innerHeight/3)}function i(e,t,n,r){function i(){var l=Date.now(),c=(l-s)/r;c<1?(e.scrollTop=t+o*Math.cos((1-c)*Math.PI/2),a=setTimeout(i,1)):(a=null,e.scrollTop=n)}a&&clearTimeout(a);var o=n-t,s=Date.now();i()}function o(){window.syncScroll=function(e){var t=e*(document.body.clientHeight-window.innerHeight);i(document.body,document.body.scrollTop,t,100)};var e=_.throttle(function(){var e=document.body.scrollTop/(document.body.clientHeight-window.innerHeight);NativeApp.syncScroll&&NativeApp.syncScroll(e)},100);window.addEventListener("scroll",function(){a||e()})}function s(e){document.body.style["margin-bottom"]=e?window.innerHeight-70+"px":0}t.c=r,t.b=o,t.a=s;var a=null},function(e,t,n){"use strict";function r(){f=[],settings.markdownCellLaTeXDisplayDelimiter1&&f.push({left:"$$",right:"$$",displayMode:!0,includeMarkers:!1}),settings.markdownCellLaTeXDisplayDelimiter2&&f.push({left:"\\[",right:"\\]",displayMode:!0,includeMarkers:!1}),settings.markdownCellLaTeXInlineDelimiter1&&f.push({left:"$",right:"$",displayMode:!1,includeMarkers:!1}),settings.markdownCellLaTeXInlineDelimiter2&&f.push({left:"\\(",right:"\\)",displayMode:!1,includeMarkers:!1}),f.push({left:/^\\begin\{([^}]*)\}/,right:"\\end{$1}",displayMode:!0,includeMarkers:!0,regex:!0})}function i(e,t){for(var n=0;n<f.length;n++){var r=f[n];if(!r.regex){var i=t;if(e.slice(i,i+r.left.length)!==r.left)continue;i+=r.left.length;var o=e.indexOf(r.right,i);if(o===-1)continue;var s=o+r.right.length;return{math:r.includeMarkers?e.slice(t,s):e.slice(i,o),pos:s,displayMode:r.displayMode}}var a=r.left.exec(e.slice(t));if(a){var l=r.right.replace("$1",a[1]),c=e.indexOf(l,t);if(c===-1)continue;var u=c+l.length;return{math:e.slice(t,u),pos:u,displayMode:!0}}}return!1}function o(){p={}}function s(e,t,n){if(n.length>0){var r=document.getElementById("hidden-div");n.forEach(function(e){p[e]||(MathJax.Hub.Queue(function(){return r.innerText=e}),MathJax.Hub.Queue(["Typeset",MathJax.Hub,r]),MathJax.Hub.Queue(function(){return p[e]=r.innerHTML}))}),MathJax.Hub.Queue(function(){e.innerHTML=t.replace(/\$PLACEHOLDER\$/g,function(){return p[n.shift()]})})}else e.innerHTML=t}function a(e,t){e=e.replace(/\n$/,""),t=t?t.trim().toLowerCase():"";var n=WebUtils.modeNameForAlias(t),r=u.b(n),i=u.a(settings.codeCellTheme);return"<pre>"+h.renderSync(e,r,i,1,!settings.codeCellShowLineNumbers).html+"</pre>"}function l(e){var t={html:!0};e.breaks&&(t.breaks=e.breaks),e.aceSyntaxHighlight&&(t.highlight=a),d.a("vendor/markdown-it.min.js");var n=window.markdownit(t),r=d.a("vendor/markdown-it-lazy-headers.js","module");if(n.use(r),e.taskList){var i=d.a("vendor/markdown-it-task-lists.js","module");n.use(i)}return n.use(g),n}function c(){return m||(m=l({taskList:!0,aceSyntaxHighlight:!0})),m}var u=n(1),d=n(0);t.a=r,t.c=i,t.b=o,t.d=s,t.f=l,t.e=c;var h=ace.require("ace/ext/static_highlight"),f=[],p={},g=function(e){e.inline.ruler.before("escape","math",function(e,t){var n=i(e.src,e.pos);if(!n)return!1;if(!t){var r=n.displayMode?"display_math":"inline_math";e.push(r,"",0).content=n.math}return e.pos=n.pos,!0}),e.renderer.rules.inline_math=function(t,n){return e.placeholders.push("$"+t[n].content+"$"),"$PLACEHOLDER$"},e.renderer.rules.display_math=function(t,n){return e.placeholders.push("$$"+t[n].content+"$$"),"$PLACEHOLDER$"}},m=null},,function(e,t,n){"use strict";t.a={ace:null,vim:"ace/keyboard/vim",emacs:"ace/keyboard/emacs"}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=n(9),a=n(5),l=n(0),c=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(r)},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=ace.require("ace/search"),h=d.Search,f=ace.require("ace/range"),p=f.Range,g=ace.require("ace/keyboard/hash_handler"),m=g.HashHandler,v=function(e){function t(e,n){r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return o.addExtraKeys=o.addExtraKeys.bind(o),o.language=e.language||settings.codeCellDefaultLanguage,o.highlightMarkers=[],o.keybinding="ace",o.createEditor(),o}return o(t,e),u(t,[{key:"className",get:function(){return"cell code-cell"}},{key:"type",get:function(){return"code"}}]),u(t,[{key:"destroy",value:function(){this.editor.removeAllListeners("focus"),this.editor.removeAllListeners("blur"),this.editor.removeAllListeners("change"),this.editor.destroy(),c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"setLanguage",value:function(e){this.language=e,this.editor.getSession().setMode({path:"ace/mode/"+this.language,inline:!0})}},{key:"setValue",value:function(e){this.silent=!0,this.editor.setValue(e,-1),this.silent=!1}},{key:"render",value:function(){return this.setValue(this.data),this}},{key:"createEditor",value:function(){this.el.innerHTML="<div class='editor'></div>",this.editor=ace.edit(this.el.firstChild),this.editor.setTheme("ace/theme/"+settings.codeCellTheme),this.editor.getSession().setUseWorker(!1),this.editor.getSession().setMode({path:"ace/mode/"+this.language,inline:!0}),this.editor.getSession().setTabSize(settings.codeCellTabSize),this.editor.getSession().setUseSoftTabs(settings.codeCellUseSoftTabs),this.editor.renderer.setShowGutter(settings.codeCellShowLineNumbers),this.editor.setShowInvisibles(settings.codeCellShowInvisibles),this.editor.setDisplayIndentGuides(settings.codeCellShowIndentGuides),this.keybinding=settings.codeCellKeyBinding,this.editor.setKeyboardHandler(a.a[this.keybinding],this.addExtraKeys),this.configureEditor()}},{key:"configureEditor",value:function(){var e=this;this.editor.$blockScrolling=1/0,this.editor.setAutoScrollEditorIntoView(!0),this.editor.setOption("maxLines",1e4),this.editor.setHighlightActiveLine(!1),this.editor.setShowPrintMargin(!1),this.editor.setReadOnly(!1),this.editor.getSession().setUseWrapMode(!0),this.editor.getSession().$selectLongWords=!0,this.editor.commands.removeCommand("showSettingsMenu"),this.editor.commands.removeCommand("findnext"),this.editor.commands.removeCommand("findprevious"),this.editor.commands.removeCommand("selectOrFindNext"),this.editor.commands.removeCommand("selectOrFindPrevious"),this.editor.commands.removeCommand("find"),this.editor.commands.removeCommand("replace"),this.editor.commands.removeCommand("copylinesup"),this.editor.commands.removeCommand("copylinesdown"),this.editor.commands.removeCommand("undo"),this.editor.commands.removeCommand("redo"),this.editor.commands.removeCommand("sortlines"),this.editor.commands.removeCommand("toggleBlockComment"),this.editor.on("focus",this.activate.bind(this)),this.editor.on("blur",this.deactivate.bind(this)),this.editor.on("change",function(){e.silent||e.onChange()})}},{key:"addExtraKeys",value:function(){var e=this,t=new m;t.bindKey("Ctrl-P","golineup"),t.bindKeys({Backspace:function(){return e.doc.backspaceInCell(e)},Up:function(){return e.doc.upArrowInCell(e)},"Command-Up":function(){return e.doc.upArrowInCell(e)},Down:function(){return e.doc.downArrowInCell(e)},"Command-Down":function(){return e.doc.downArrowInCell(e)},Left:function(){return e.doc.leftArrowInCell(e)},"Command-Left":function(){return e.doc.leftArrowInCell(e)},Right:function(){return e.doc.rightArrowInCell(e)},"Command-Right":function(){return e.doc.rightArrowInCell(e)},Escape:function(){return"vim"!==e.keybinding&&NativeApp.escapeNote()}}),this.editor.keyBinding.addKeyboardHandler(t)}},{key:"toJSON",value:function(){return{type:this.type,language:this.language,data:this.data}}},{key:"isEmpty",value:function(){return 0===this.text().replace(/\s+/,"").length}},{key:"text",value:function(){return this.editor.getValue()}},{key:"getData",value:function(){return this.editor.getValue()}},{key:"focus",value:function(){this.editor.isFocused()||this.editor.focus()}},{key:"activate",value:function(){this.cursorPos=this.getCursorPosition(),this.doc.selectedCell=this,this.el.classList.add("inEditMode"),this.doc.updateFormatBarDebounced(this.type,this)}},{key:"deactivate",value:function(){this.doc.selectedCell===this&&(this.doc.selectedCell=null),this.el.classList.remove("inEditMode"),NativeApp.shouldSkipFormatBarUpdate()||this.doc.updateFormatBarDebounced("title")}},{key:"getCursorPosition",value:function(){return this.editor.getCursorPosition()}},{key:"getFileEndPosition",value:function(){var e=this.editor.session.getLength()-1;return{row:e,column:this.editor.session.getLine(e).length}}},{key:"cursorIsAtStart",value:function(){var e=this.getCursorPosition();return 0===e.row&&0===e.column&&this.editor.selection.isEmpty()}},{key:"cursorIsAtEnd",value:function(){var e=this.getCursorPosition(),t=this.editor.session.getLength()-1,n=this.editor.session.getLine(t).length;return"vim"===this.keybinding?e.row===t&&e.column>=n-1&&this.editor.selection.isEmpty():e.row===t&&e.column===n&&this.editor.selection.isEmpty()}},{key:"moveCursorToPosition",value:function(e){this.editor.moveCursorToPosition(e),this.cursorPos=e,this.focus()}},{key:"moveCursorToStart",value:function(){this.editor.navigateFileStart(),this.focus()}},{key:"moveCursorToEnd",value:function(){this.editor.navigateFileEnd(),this.focus()}},{key:"splitAtCursor",value:function(){var e=[],t=this.editor.session,n=this.editor.getSelectionRange(),r=new p(0,0,n.start.row,n.start.column);e.push(t.getTextRange(r));var i=t.getTextRange(n);i.length>0&&e.push(i);var o=t.getLength()-1,s=t.getLine(o).length,a=new p(n.end.row,n.end.column,o,s);return e.push(t.getTextRange(a)),e}},{key:"searchAndHighlight",value:function(e){var t=this;this.removeHighlight();var n=new RegExp(e.join("|"),"gi"),r=new h;r.set({needle:n,regExp:!0});var i=this.editor.getSession(),o=r.findAll(i);return o.forEach(function(e){var n=i.addMarker(e,"highlighted","text");t.highlightMarkers.push(n)}),o.length}},{key:"removeHighlight",value:function(){var e=this.editor.getSession();this.highlightMarkers.forEach(function(t){e.removeMarker(t)}),this.highlightMarkers=[]}},{key:"prettyPrint",value:function(){l.a("vendor/vkbeautify.0.99.00.beta.js");var e=settings.codeCellTabSize;"json"===this.language?this.setValue(vkbeautify.json(this.data,e)):"xml"===this.language?this.setValue(vkbeautify.xml(this.data,e)):"css"===this.language?this.setValue(vkbeautify.css(this.data,e)):"sql"===this.language&&this.setValue(vkbeautify.sql(this.data,e)),this.onChange()}},{key:"execCommand",value:function(e,t){}}]),t}(s.a);t.a=v},function(e,t,n){"use strict";var r=n(2);t.a={searchAndHighlight:function(e){if(!e)return"0 of 0";var t=e.match(/[^\s"]+|"[^"]*"/g).filter(function(e){return"#"!==e[0]}).map(function(e){return e.replace(/"/g,"")}),n=0;return n+=this.titleArea.searchAndHighlight(t),this.cells.forEach(function(e){n+=e.searchAndHighlight(t)}),setTimeout(function(){var e=document.querySelector(".highlighted");e&&(e.classList.add("selected"),r.c(e))},100),n>0?"1 of "+n:"0 of 0"},removeHighlight:function(){0!==document.querySelectorAll(".highlighted").length&&(this.titleArea.removeHighlight(),this.cells.forEach(function(e){return e.removeHighlight()}))},findNext:function(e){var t=document.querySelectorAll(".highlighted"),n=t.length;if(n>0){for(var i=0,o=0;o<t.length;o++){var s=t[o];if(s.classList.contains("selected")){i=o+1,i%=n,s.classList.remove("selected");break}}var a=t[i];return a&&(a.classList.add("selected"),r.c(a)),i+1+" of "+n}return this.searchAndHighlight(e)},findPrevious:function(e){var t=document.querySelectorAll(".highlighted"),n=t.length;if(n>0){for(var i=0,o=0;o<t.length;o++){var s=t[o];if(s.classList.contains("selected")){i=o-1,i<0&&(i+=n),s.classList.remove("selected");break}}var a=t[i];return a&&(a.classList.add("selected"),r.c(a)),i+1+" of "+n}return this.searchAndHighlight(e)}}},function(e,t,n){"use strict";function r(e,t){function n(e){if(3===e.nodeType){var t=e.nodeValue.match(i);t&&(r+=t.length,e.nodeValue.split(i).forEach(function(t){if(t.match(i)){var n=document.createElement("span");n.classList.add("highlighted"),n.innerText=t,e.parentNode.insertBefore(n,e)}else{var r=document.createTextNode(t);e.parentNode.insertBefore(r,e)}}),e.parentNode.removeChild(e))}else if(1===e.nodeType&&e.childNodes&&!/(style|script|svg)/i.test(e.tagName)){var o=Array.prototype.slice.call(e.childNodes);o.forEach(function(e){return n(e)})}}var r=0,i=new RegExp("("+t.join("|")+")","gi");return n(e),r}t.a=r},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t,n){r(this,e),this.doc=n,this.data=t.data,this.el=document.createElement("div"),this.el.className=this.className,this.onContentChange=_.debounce(this.doc.onContentChange,300),this.saveContent=_.debounce(this.doc.saveContent,1e3)}return i(e,[{key:"className",get:function(){return"cell"}}]),i(e,[{key:"onChange",value:function(){this.onContentChange(this),this.saveContent()}},{key:"destroy",value:function(){this.el.parentNode.removeChild(this.el),this.doc=null}},{key:"replaceWith",value:function(e){this.el.parentNode.replaceChild(e.el,this.el)}},{key:"after",value:function(e){this.el.insertAdjacentElement("afterend",e.el)}},{key:"before",value:function(e){this.el.insertAdjacentElement("beforebegin",e.el)}},{key:"insertAfter",value:function(e){e.el.insertAdjacentElement("afterend",this.el)}},{key:"insertBefore",value:function(e){e.el.insertAdjacentElement("beforebegin",this.el)}}]),e}();t.a=o},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=n(9),a=n(11),l=n(8),c=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=function(e){function t(e,n){r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));if(o.el.setAttribute("contentEditable",!0),o.el.addEventListener("focus",o.activate.bind(o)),o.el.addEventListener("blur",o.deactivate.bind(o)),o.el.addEventListener("input",o.onChange.bind(o)),o.el.addEventListener("change",function(e){"checkbox"===e.target.type&&o.updateCheckbox(e.target)}),"text"===o.type){var s=function(){o.doc.updateFormatBarDebounced(o.type,o)};["input","keyup","paste","mouseup"].forEach(function(e){o.el.addEventListener(e,s)})}return o.el.addEventListener("keydown",o.onKeydown.bind(o)),o}return o(t,e),u(t,[{key:"className",get:function(){return"cell text-cell"}},{key:"type",get:function(){return"text"}}]),u(t,[{key:"render",value:function(){return this.el.innerHTML=this.data,this}},{key:"toJSON",value:function(){return{type:this.type,data:this.data}}},{key:"isEmpty",value:function(){return 0===this.text().replace(/\s+/,"").length&&0===this.el.querySelectorAll("img").length}},{key:"text",value:function(){return this.el.textContent}},{key:"getData",value:function(){return this.el.innerHTML}},{key:"focus",value:function(){this.el.focus()}},{key:"activate",value:function(){var e=this;setTimeout(function(){return e.cursorPos=e.getCursorPosition()}),this.doc.selectedCell=this,this.el.classList.add("inEditMode"),this.doc.updateFormatBarDebounced(this.type,this)}},{key:"deactivate",value:function(){this.doc.selectedCell===this&&(this.doc.selectedCell=null),this.el.classList.remove("inEditMode"),NativeApp.shouldSkipFormatBarUpdate()||this.doc.updateFormatBarDebounced("title")}},{key:"updateCheckbox",value:function(e){e.checked?e.setAttribute("checked","checked"):e.removeAttribute("checked"),this.onChange()}},{key:"onKeydown",value:function(e){switch(e.which){case 8:if(!(e.shiftKey||e.altKey||e.ctrlKey||e.metaKey)){this.doc.backspaceInCell(this)&&e.preventDefault()}break;case 38:if(!e.shiftKey&&!e.altKey&&!e.ctrlKey){this.doc.upArrowInCell(this)&&e.preventDefault()}break;case 40:if(!e.shiftKey&&!e.altKey&&!e.ctrlKey){this.doc.downArrowInCell(this)&&e.preventDefault()}break;case 37:if(!e.shiftKey&&!e.altKey&&!e.ctrlKey){this.doc.leftArrowInCell(this)&&e.preventDefault()}break;case 39:if(!e.shiftKey&&!e.altKey&&!e.ctrlKey){this.doc.rightArrowInCell(this)&&e.preventDefault()}break;case 9:if(document.queryCommandState("insertUnorderedList")||document.queryCommandState("insertOrderedList"))e.shiftKey?document.execCommand("outdent",!1,null):document.execCommand("indent",!1,null);else{var t=Array(settings.textCellTabSize+1).join(" ");e.shiftKey||document.execCommand("insertText",!1,t)}e.preventDefault();break;case 27:NativeApp.escapeNote(),e.preventDefault()}}},{key:"getCursorPosition",value:function(){return a.b(this.el)}},{key:"getFileEndPosition",value:function(){var e=this.text().length;return{start:e,end:e}}},{key:"cursorIsAtStart",value:function(){var e=window.getSelection().getRangeAt(0),t=a.c(this.el),n=t.cloneContents(),r=t.toString();return(0===r.length||" "===r)&&e.collapsed&&0===n.querySelectorAll("img").length&&0===n.querySelectorAll("hr").length&&n.querySelectorAll("li").length<=1&&0===n.querySelectorAll("input").length&&0===n.querySelectorAll("br").length}},{key:"cursorIsAtEnd",value:function(){var e=window.getSelection(),t=e.getRangeAt(0),n=a.d(this.el),r=n.cloneContents(),i=n.toString();return(0===i.length||" "===i)&&t.collapsed&&0===r.querySelectorAll("img").length&&0===r.querySelectorAll("hr").length&&r.querySelectorAll("li").length<=1&&0===r.querySelectorAll("input").length&&(0===r.querySelectorAll("br").length||1===r.querySelectorAll("br").length&&1===("function"==typeof e.focusNode.querySelectorAll?e.focusNode.querySelectorAll("br").length:void 0))}},{key:"moveCursorToPosition",value:function(e){e&&(a.e(this.el,e),this.cursorPos=e,this.focus())}},{key:"moveCursorToStart",value:function(){a.f(this.el),this.focus()}},{key:"moveCursorToEnd",value:function(){a.g(this.el),this.focus()}},{key:"splitAtCursor",value:function(){var e=[],t=window.getSelection().getRangeAt(0),n=a.c(this.el),r=document.createElement("div");r.appendChild(n.cloneContents()),e.push(r.innerHTML),t.collapsed||(r=document.createElement("div"),r.appendChild(t.cloneContents()),e.push(r.innerHTML));var i=a.d(this.el);return r=document.createElement("div"),r.appendChild(i.cloneContents()),e.push(r.innerHTML),e}},{key:"searchAndHighlight",value:function(e){return this.removeHighlight(),l.a(this.el,e)}},{key:"removeHighlight",value:function(){this.render()}},{key:"execCommand",value:function(e,t){switch(this.cursorPos=this.getCursorPosition(),e){case"formatBlock":this.queryCommandState(e,t)?document.execCommand("formatBlock",!1,"div"):document.execCommand(e,!1,t);break;case"increaseHeadingLevel":var n=document.queryCommandValue("formatBlock").match(/\d/),r=n?parseInt(n[0],10):0;r<6&&(r+=1),document.execCommand("formatBlock",!1,"h"+r);break;case"decreaseHeadingLevel":var i=document.queryCommandValue("formatBlock").match(/\d/),o=i?parseInt(i[0],10):0;o>0&&(o-=1),document.execCommand("formatBlock",!1,o>0?"h"+o:"p");break;case"highlight":this.queryCommandState(e)?(document.execCommand("foreColor",!1,getComputedStyle(document.body).color),document.execCommand("backColor",!1,"transparent")):(document.execCommand("foreColor",!1,"#323232"),document.execCommand("backColor",!1,"rgb(254, 250, 0)"));break;case"inlineCode":a.h(),this.onChange();break;case"link":var s=c(t,2),l=s[0],u=s[1],d='<a href="'+u+'">'+l+"</a>";document.execCommand("insertHTML",!1,d);break;case"insertTodo":document.execCommand("insertHTML",!1,'<input type="checkbox"> ');break;case"insertImage":var h=c(t,2),f=h[0],p=h[1],g='<img src="quiver-image-url/'+p+'" alt="'+f+'">';document.execCommand("insertHTML",!1,g);break;case"insertAttachment":var m=c(t,2),v=m[0],y=m[1],C='<a href="quiver-file-url/'+y+'">'+v+"</a>";document.execCommand("insertHTML",!1,C);break;default:document.execCommand(e,!1,t)}}},{key:"queryCommandState",value:function(e,t){if(t){var n=document.queryCommandValue(e);return new RegExp(t,"i").test(n)}return"highlight"===e?"rgb(254, 250, 0)"===document.queryCommandValue("backColor"):"inlineCode"===e?a.i():document.queryCommandState(e)}},{key:"getStyles",value:function(){var e=this,t={};return[["bold",null],["italic",null],["underline",null],["strikeThrough",null],["highlight",null],["inlineCode",null],["insertUnorderedList",null],["insertOrderedList",null],["formatBlock","h1"],["formatBlock","h2"],["formatBlock","h3"]].forEach(function(n){var r=c(n,2),i=r[0],o=r[1],s=e.queryCommandState(i,o);o?t[i+":"+o]=s:t[i]=s}),t}}]),t}(s.a);t.a=d},function(e,t,n){"use strict";function r(e,t){t=t.toUpperCase();for(var n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];if(i.nodeName===t)return i;var o=r(i,t);if(o)return o}return null}function i(e,t){t=t.toUpperCase();for(var n=0;e&&"HTML"!==e.tagName&&n<10;){if(e.tagName===t)return e;e=e.parentNode,n+=1}return null}function o(e){var t=window.getSelection().getRangeAt(0),n=document.createRange();return n.selectNodeContents(e),n.setEnd(t.startContainer,t.startOffset),n}function s(e){var t=window.getSelection().getRangeAt(0),n=document.createRange();return n.selectNodeContents(e),n.setStart(t.endContainer,t.endOffset),n}function a(e){var t=document.createRange();t.selectNodeContents(e),t.collapse(!0);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}function l(e){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}function c(){if(window.getSelection().rangeCount<=0)return JSON.stringify(["",""]);var e=window.getSelection().getRangeAt(0),t=e.toString(),n="http://";if(e.startContainer===e.endContainer){var i=e.startContainer;3===i.nodeType&&(i=i.parentNode),"A"===i.nodeName&&(n=i.getAttribute("href"))}var o=r(e.cloneContents(),"A");return o&&(n=o.getAttribute("href")),JSON.stringify([t,n])}function u(e){if(!(window.getSelection().rangeCount<=0)){var t=window.getSelection().getRangeAt(0),n=t.cloneRange();n.selectNodeContents(e),n.setEnd(t.startContainer,t.startOffset);var r=n.toString().length;return{start:r,end:r+t.toString().length}}}function d(e,t){var n=0,r=document.createRange();r.setStart(e,0),r.collapse(!0);for(var i=[e],o=void 0,s=!1,a=!1;!a&&(o=i.pop());)if(3===o.nodeType){var l=n+o.length;!s&&t.start>=n&&t.start<=l&&(r.setStart(o,t.start-n),s=!0),s&&t.end>=n&&t.end<=l&&(r.setEnd(o,t.end-n),a=!0),n=l}else for(var c=o.childNodes.length;c--;)i.push(o.childNodes[c]);var u=window.getSelection();u.removeAllRanges(),u.addRange(r)}function h(){return!(window.getSelection().rangeCount<=0)&&null!=i(window.getSelection().getRangeAt(0).startContainer,"CODE")}function f(){if(!(window.getSelection().rangeCount<=0)){var e=h(),t=window.getSelection(),n=t.getRangeAt(0),r=n.toString(),a=""===r;a&&(r="​");var l=document.createTextNode(r),c=i(n.commonAncestorContainer,"CODE");if(c){var u=document.createDocumentFragment(),d=o(c);if(d.toString().length>0){var f=document.createElement("code");f.appendChild(d.cloneContents()),u.appendChild(f)}u.appendChild(l);var p=s(c);if(p.toString().length>0){var g=document.createElement("code");g.appendChild(p.cloneContents()),u.appendChild(g)}c.parentNode.replaceChild(u,c),n.selectNodeContents(l),a&&n.collapse(!1)}else if(n.deleteContents(),e)n.insertNode(l);else{var m=document.createElement("code");m.appendChild(l),n.insertNode(m),n.selectNodeContents(l),a&&n.collapse(!1)}t.removeAllRanges(),t.addRange(n)}}t.c=o,t.d=s,t.f=a,t.g=l,t.a=c,t.b=u,t.e=d,t.i=h,t.h=f},function(e,t,n){"use strict";function r(e){return Array.isArray(e)?e:Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return e.map(function(e){return{diffs:e.diffs.map(function(e){return[e[0]*-1,e[1]]}),start1:e.start2,start2:e.start1,length1:e.length2,length2:e.length1}})}var s=n(10),a=n(6),l=n(16),c=n(15),u=n(14),d=n(17),h=n(11),f=n(0),p=n(3),g=n(7),m=n(2),v=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},C=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();m.b(),f.a("vendor/diff_match_patch.js");var b=new diff_match_patch,k=function(){function e(t,n,r,o){i(this,e),this.id=t,this.title=n,this.tags=r.slice(0),this.content=o,this.el=document.body,this.cells=[],this.selectedCell=null,this.updateFormatBarDebounced=_.debounce(this.updateFormatBar,100),this.onContentChange=this.onContentChange.bind(this),this.saveContent=this.saveContent.bind(this),this.onClick=this.onClick.bind(this),this.hideFindBar=this.hideFindBar.bind(this),this.el.addEventListener("click",this.hideFindBar),document.addEventListener("click",this.onClick),y(this,g.a)}return C(e,[{key:"destroy",value:function(){this.el.removeEventListener("click",this.hideFindBar),document.removeEventListener("click",this.onClick),this.titleArea.destroy(),this.cells.forEach(function(e){return e.destroy()}),this.el.innerHTML=""}},{key:"render",value:function(){var e=this;this.el.innerHTML='\n      <div id="titlearea"></div>\n      <div id="contentarea"></div>\n      <div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; overflow: visible; white-space: nowrap;opacity: 0 !important;pointer-events: none !important;"></div>\n    ',this.titleArea=new d.a({data:this.title},this),this.el.querySelector("#titlearea").appendChild(this.titleArea.render().el),this.cells=[];var t=this.el.querySelector("#contentarea");return JSON.parse(this.content).cells.forEach(function(n){var r=e.createCell(n);t.appendChild(r.el),r.render(),e.cells.push(r)}),this}},{key:"execCommand",value:function(e,t){this.selectedCell&&this.selectedCell.execCommand(e,t)}},{key:"linkInSelection",value:function(){if(this.selectedCell&&"markdown"===this.selectedCell.type){var e=this.selectedCell.editor.getSelectedText().replace(/(\r\n|\n|\r)/gm," ").trim();return JSON.stringify([e,"http://"])}return h.a()}},{key:"existsImageSrc",value:function(e){return this.el.querySelectorAll("img[src='"+e+"']").length>0}},{key:"updateImageSrc",value:function(e,t){for(var n=this.el.querySelectorAll("img[src='"+e+"']"),r=0;r<n.length;r++){var i=n[r];i.setAttribute("src",t);var o=document.createEvent("HTMLEvents");o.initEvent("input",!0,!1),i.dispatchEvent(o)}}},{key:"prettyPrint",value:function(){"code"===this.selectedCell.type&&this.selectedCell.prettyPrint()}},{key:"hasSelectedCell",value:function(){return this.selectedCell&&"title"!==this.selectedCell.type}},{key:"getSelectedCellType",value:function(){return this.selectedCell?this.selectedCell.type:null}},{key:"createCell",value:function(e){return new{text:s.a,code:a.a,markdown:l.a,latex:c.a,diagram:u.a}[e.type](e,this)}},{key:"focusTitleArea",value:function(){this.titleArea.focus()}},{key:"focusFirstCell",value:function(){if(this.cells.length>0){this.cells[0].moveCursorToStart()}else this.newCell()}},{key:"onContentChange",value:function(e){var t=void 0,n=void 0,r=e.getData(),i=e.getCursorPosition();if("title"===e.type)t={method:"updateTitle",args:[{title:r,cursorPos:i}]},n={method:"updateTitle",args:[{title:e.data,cursorPos:e.cursorPos}]};else{var s=this.cells.indexOf(e);if(s===-1)return;var a=b.patch_make(e.data,r);t={method:"updateCell",args:[s,{patches:a,cursorPos:i}]},n={method:"updateCell",args:[s,{patches:o(a),cursorPos:e.cursorPos}]}}NativeApp.forwardOp(this.id,JSON.stringify(t),JSON.stringify(n)),e.data=r,e.cursorPos=i}},{key:"saveContent",value:function(){var e=this;this.title=this.titleArea.data;var t=JSON.stringify({title:this.title,cells:this.cells.map(function(e){return e.toJSON()})},void 0,2);if(t!==this.content){var n=/(quiver-image-url|quiver-file-url)\/[a-zA-Z0-9.-]*/g,r=_.uniq(this.content.match(n)),i=_.uniq(t.match(n));_.difference(i,r).forEach(function(t){NativeApp.addResource(e.id,t)}),_.difference(r,i).forEach(function(t){NativeApp.removeResource(e.id,t)}),this.content=t,NativeApp.saveContent(this.id,t)}}},{key:"updateContent",value:function(){this.title=this.titleArea.data,this.content=JSON.stringify({title:this.title,cells:this.cells.map(function(e){return e.toJSON()})},void 0,2)}},{key:"updateFormatBar",value:function(e,t){switch(e){case"title":NativeApp.updateFormatBar("title");break;case"text":NativeApp.updateFormatBar("text",JSON.stringify({styles:t.getStyles()}));break;case"code":NativeApp.updateFormatBar("code",JSON.stringify({language:t.language}));break;case"markdown":NativeApp.updateFormatBar("markdown",JSON.stringify({styles:{}}));break;case"latex":NativeApp.updateFormatBar("latex");break;case"diagram":NativeApp.updateFormatBar("diagram",JSON.stringify({diagramType:t.diagramType}))}}},{key:"selectedText",value:function(){return this.selectedCell&&["code","markdown","latex","diagram"].indexOf(this.selectedCell.type)>-1?this.selectedCell.editor.getSelectedText():window.getSelection().rangeCount>0?window.getSelection().getRangeAt(0).toString():""}},{key:"hideFindBar",value:function(){this.removeHighlight(),NativeApp.hideFindBar()}},{key:"applyOp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this[e.method](e.args);t.save?this.saveContent():this.updateContent(),t.forward&&NativeApp.forwardOp(this.id,JSON.stringify(e),JSON.stringify(n))}},{key:"updateTitle",value:function(e){var t=v(e,1),n=t[0],r={};return r.title=this.titleArea.data,this.titleArea.data=n.title,this.titleArea.render(),n.cursorPos&&(r.cursorPos=this.titleArea.cursorPos,this.titleArea.moveCursorToPosition(n.cursorPos)),this.updateFormatBarDebounced("title"),{method:"updateTitle",args:[r]}}},{key:"updateCell",value:function(e){var t=v(e,2),n=t[0],r=t[1],i={},s=this.cells[n];for(var a in r)"patches"===a?(i.patches=o(r.patches),s.data=b.patch_apply(r.patches,s.data)[0],s.render()):"language"===a&&"code"===s.type?(i.language=s.language,s.setLanguage(r.language)):"diagramType"===a&&"diagram"===s.type&&(i.diagramType=s.diagramType,s.setDiagramType(r.diagramType));return r.cursorPos&&(i.cursorPos=s.cursorPos,s.moveCursorToPosition(r.cursorPos)),this.updateFormatBarDebounced(s.type,s),{method:"updateCell",args:[n,i]}}},{key:"replaceCell",value:function(e){var t=v(e,2),n=t[0],r=t[1],i=this.cells[n],o={method:"replaceCell",args:[n,i.toJSON()]},s=this.createCell(r);return i.replaceWith(s.render()),this.cells[n]=s,s.focus(),o}},{key:"insertCell",value:function(e){var t=v(e,2),n=t[0],r=t[1],i=this.createCell(r),o=this.el.querySelector("#contentarea");n===-1?(this.cells.push(i),o.insertAdjacentElement("beforeend",i.render().el)):0===n?(this.cells.splice(0,0,i),o.insertAdjacentElement("afterbegin",i.render().el)):(this.cells.splice(n,0,i),this.cells[n-1].after(i.render()));var s={method:"deleteCell",args:[this.cells.indexOf(i)]};return i.focus(),m.c(i.el),s}},{key:"deleteCell",value:function(e){var t=v(e,1),n=t[0],r=this.cells[n],i={method:"insertCell",args:[n,r.toJSON()]};return r.destroy(),this.cells.splice(n,1),i}},{key:"splitCell",value:function(e){for(var t=r(e),n=t[0],i=t[1],o=t.slice(2),s=this.cells[n],a=s.toJSON(),l=0;l<o.length;l++){a.data=o[l];var c=this.createCell(a);this.cells.splice(n+1+l,0,c),this.cells[n+l].after(c.render())}return s.destroy(),this.cells.splice(n,1),this.cells[n+1].moveCursorToStart(),{method:"mergeCells",args:[n,o.length,i]}}},{key:"mergeCells",value:function(e){for(var t=v(e,3),n=t[0],r=t[1],i=t[2],o=this.cells[n],s=o.toJSON(),a=[],l=0;l<r;l++)a.push(this.cells[n+l].data);s.data=a.join("");var c=this.createCell(s);this.cells.splice(n,0,c),o.before(c.render()),c.moveCursorToPosition(i);for(var u=0;u<r;u++)o=this.cells[n+u+1],o.destroy();return this.cells.splice(n+1,r),{method:"splitCell",args:[n,i].concat(a)}}},{key:"moveCell",value:function(e){var t=v(e,2),n=t[0],r=t[1],i=this.cells[n];this.cells.splice(n,1),this.cells.splice(r,0,i),r-1>=0?i.insertAfter(this.cells[r-1]):i.insertBefore(this.cells[r+1]);var o={method:"moveCell",args:[r,n]};return i.focus(),o}},{key:"changeSelectedCellType",value:function(e){if(this.selectedCell){var t=this.selectedCell.type;if(e!==t){var n=void 0;if("text"===t&&["code","latex","diagram"].indexOf(e)>-1)n=this.selectedCell.el.innerText.replace(/\u00A0/g," ").replace(/(\u201C|\u201D)/g,'"').replace(/\n$/,"");else if(["code","latex","diagram"].indexOf(t)>-1&&"text"===e)n="",this.selectedCell.data.split("\n").forEach(function(e){e.length>0?(e=e.replace(/^\s/,"&nbsp;"),n+="<div>"+e+"</div>"):n+="<div><br></div>"});else if("text"===t&&"markdown"===e)f.a("vendor/unmarked.js"),n=unmarked(this.selectedCell.data,{gfm:!0,headerStyle:"atx"});else if("markdown"===t&&"text"===e){var r=p.f({taskList:!0,breaks:settings.markdownCellUseGFMLinebreaks});n=r.render(this.selectedCell.data)}else n=this.selectedCell.data;var i=this.cells.indexOf(this.selectedCell),o={method:"replaceCell",args:[i,{type:e,data:n}]};this.applyOp(o,{save:!0,forward:!0})}}}},{key:"updateSelectedCell",value:function(e){if(this.selectedCell){var t=this.cells.indexOf(this.selectedCell),n=JSON.parse(e),r={method:"updateCell",args:[t,n]};this.applyOp(r,{save:!0,forward:!0})}}},{key:"newCell",value:function(){var e=this.selectedCell?this.cells.indexOf(this.selectedCell)+1:-1,t={method:"insertCell",args:[e,{type:settings.defaultCellType,data:""}]};this.applyOp(t,{save:!0,forward:!0})}},{key:"newCellAbove",value:function(){var e=this.selectedCell?this.cells.indexOf(this.selectedCell):-1,t={method:"insertCell",args:[e,{type:settings.defaultCellType,data:""}]};this.applyOp(t,{save:!0,forward:!0})}},{key:"newCellAtCursor",value:function(){if(this.selectedCell){var e=this.cells.indexOf(this.selectedCell),t=this.selectedCell.getCursorPosition(),n=this.selectedCell.splitAtCursor();2===n.length&&n.splice(1,0,"");var r={method:"splitCell",args:[e,t].concat(n)};this.applyOp(r,{save:!0,forward:!0})}}},{key:"splitSelectedCell",value:function(){if(this.selectedCell){var e=this.cells.indexOf(this.selectedCell),t=this.selectedCell.getCursorPosition(),n=this.selectedCell.splitAtCursor(),r={method:"splitCell",args:[e,t].concat(n)};this.applyOp(r,{save:!0,forward:!0})}}},{key:"cutSelectedCell",value:function(){if(this.selectedCell){var e=JSON.stringify(this.selectedCell.toJSON()),t=this.cells.indexOf(this.selectedCell),n={method:"deleteCell",args:[t]};this.applyOp(n,{save:!0,forward:!0});var r=this.cells[Math.min(t,this.cells.length-1)];return r?r.focus():this.selectedCell=null,e}}},{key:"copySelectedCell",value:function(){if(this.selectedCell)return JSON.stringify(this.selectedCell.toJSON())}},{key:"pasteCell",value:function(e){var t=this.selectedCell?this.cells.indexOf(this.selectedCell)+1:-1,n=JSON.parse(e),r={method:"insertCell",args:[t,n]};this.applyOp(r,{save:!0,forward:!0})}},{key:"deleteSelectedCell",value:function(){if(this.selectedCell){var e=this.cells.indexOf(this.selectedCell),t={method:"deleteCell",args:[e]};this.applyOp(t,{save:!0,forward:!0});var n=this.cells[Math.min(e,this.cells.length-1)];n?n.focus():this.selectedCell=null}}},{key:"moveSelectedCellUp",value:function(){if(this.selectedCell){var e=this.cells.indexOf(this.selectedCell);if(!(e<1)){var t={method:"moveCell",args:[e,e-1]};this.applyOp(t,{save:!0,forward:!0})}}}},{key:"moveSelectedCellDown",value:function(){if(this.selectedCell){var e=this.cells.indexOf(this.selectedCell);if(!(e>=this.cells.length-1)){var t={method:"moveCell",args:[e,e+1]};this.applyOp(t,{save:!0,forward:!0})}}}},{key:"onClick",value:function(e){if(!(e.pageY<=70))if(0===this.cells.length)this.newCell();else if(1===this.cells.length){var t=this.cells[0];""===t.text().trim()&&t.focus()}}},{key:"backspaceInCell",value:function(e){if(!e.cursorIsAtStart())return!1;var t=this.cells.indexOf(e);if(0===t)return!1;var n=this.cells[t-1];if(n.isEmpty()){var r={method:"deleteCell",args:[t-1]};return this.applyOp(r,{save:!0,forward:!0}),!0}if(e.isEmpty()){var i={method:"deleteCell",args:[t]};return this.applyOp(i,{save:!0,forward:!0}),n.moveCursorToEnd(),!0}if(n.type===e.type){var o=n.getFileEndPosition(),s={method:"mergeCells",args:[t-1,2,o]};return this.applyOp(s,{save:!0,forward:!0}),!0}return!1}},{key:"downArrowInCell",value:function(e){if(!e.cursorIsAtEnd())return!1;var t=this.cells.indexOf(e);return t!==this.cells.length-1&&(this.cells[t+1].moveCursorToStart(),!0)}},{key:"upArrowInCell",value:function(e){if(!e.cursorIsAtStart())return!1;var t=this.cells.indexOf(e);return 0===t?(this.titleArea.moveCursorToEnd(),!0):(this.cells[t-1].moveCursorToEnd(),!0)}},{key:"leftArrowInCell",value:function(e){if(!e.cursorIsAtStart())return!1;var t=this.cells.indexOf(e);return 0===t?(NativeApp.escapeNote(),!0):(this.cells[t-1].moveCursorToEnd(),!0)}},{key:"rightArrowInCell",value:function(e){if(!e.cursorIsAtEnd())return!1;var t=this.cells.indexOf(e);return t!==this.cells.length-1&&(this.cells[t+1].moveCursorToStart(),!0)}}]),e}();t.a=k},,function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=n(6),a=n(5),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function(e){function t(e,n){r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return o.diagramType=e.diagramType||"sequence",o}return o(t,e),l(t,[{key:"className",get:function(){return"cell diagram-cell"}},{key:"type",get:function(){return"diagram"}}]),l(t,[{key:"setDiagramType",value:function(e){this.diagramType=e}},{key:"createEditor",value:function(){this.el.innerHTML="<div class='editor'></div>",this.editor=ace.edit(this.el.firstChild),this.editor.setTheme("ace/theme/"+settings.markdownCellTheme),this.editor.getSession().setUseWorker(!1),this.editor.getSession().setMode("ace/mode/asciidoc"),this.editor.renderer.setShowGutter(!1),this.editor.setKeyboardHandler(a.a[this.keybinding],this.addExtraKeys),this.configureEditor()}},{key:"toJSON",value:function(){return{type:this.type,diagramType:this.diagramType,data:this.data}}}]),t}(s.a);t.a=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=n(6),a=n(5),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),l(t,[{key:"createEditor",value:function(){this.el.innerHTML="<div class='editor'></div>",this.editor=ace.edit(this.el.firstChild),this.editor.setTheme("ace/theme/"+settings.markdownCellTheme),this.editor.getSession().setUseWorker(!1),this.editor.getSession().setMode("ace/mode/latex"),this.editor.getSession().setTabSize(settings.latexCellTabSize),this.editor.getSession().setUseSoftTabs(settings.latexCellUseSoftTabs),this.editor.renderer.setShowGutter(!1),this.keybinding=settings.latexCellKeyBinding,this.editor.setKeyboardHandler(a.a[this.keybinding],this.addExtraKeys),this.configureEditor()}},{key:"toJSON",value:function(){return{type:this.type,language:"latex",data:this.data}}},{key:"className",get:function(){return"cell latex-cell"}},{key:"type",get:function(){return"latex"}}]),t}(s.a);t.a=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=n(6),a=n(5),l=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=ace.require("ace/range"),d=u.Range,h=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),c(t,[{key:"createEditor",value:function(){this.el.innerHTML="<div class='editor'></div>",this.editor=ace.edit(this.el.firstChild),this.editor.setTheme("ace/theme/"+settings.markdownCellTheme),this.editor.getSession().setUseWorker(!1),this.editor.getSession().setMode("ace/mode/markdown"),this.editor.getSession().setTabSize(settings.markdownCellTabSize),this.editor.getSession().setUseSoftTabs(settings.markdownCellUseSoftTabs),this.editor.renderer.setShowGutter(!1),this.keybinding=settings.markdownCellKeyBinding,this.editor.setKeyboardHandler(a.a[this.keybinding],this.addExtraKeys),this.configureEditor()}},{key:"toJSON",value:function(){return{type:this.type,data:this.data}}},{key:"execCommand",value:function(e,t){var n=this.editor.getSelectedText(),r=this.editor.getCursorPosition(),i=r.row,o=this.editor.session.getLine(i);switch(e){case"bold":""===n?(this.editor.insert("****"),this.editor.getSelection().moveCursorBy(0,-2)):this.editor.insert("**"+n+"**");break;case"italic":""===n?(this.editor.insert("__"),this.editor.getSelection().moveCursorBy(0,-1)):this.editor.insert("_"+n+"_");break;case"strikeThrough":""===n?(this.editor.insert("~~~~"),this.editor.getSelection().moveCursorBy(0,-2)):this.editor.insert("~~"+n+"~~");break;case"inlineCode":""===n?(this.editor.insert("``"),this.editor.getSelection().moveCursorBy(0,-1)):this.editor.insert("`"+n+"`");break;case"insertUnorderedList":this.editor.insert("* ");break;case"insertOrderedList":this.editor.insert("1. ");break;case"insertTodo":this.editor.insert("- [ ] ");break;case"insertHorizontalRule":this.editor.insert("---\n");break;case"link":var s=l(t,2),a=s[0],c=s[1];this.editor.insert("["+a+"]("+c+")");break;case"insertImage":var u=l(t,2),h=u[0],f=u[1];this.editor.insert("!["+h+"](quiver-image-url/"+f+")");break;case"insertAttachment":var p=l(t,2),g=p[0],m=p[1];this.editor.insert("["+g+"](quiver-file-url/"+m+")");break;case"formatBlock":var v=o.match(/^#*\s*/)[0].length,y={h1:"# ",h2:"## ",h3:"### ",h4:"#### ",h5:"##### ",h6:"###### "},C=y[t]||"";this.editor.session.replace(new d(i,0,i,v),C);break;case"increaseHeadingLevel":var b=o.match(/^#*/)[0].length;b<6&&(b+=1),this.execCommand("formatBlock","h"+b);break;case"decreaseHeadingLevel":var k=o.match(/^#*/)[0].length;k>0&&(k-=1),this.execCommand("formatBlock",k>0?"h"+k:"p");break;case"insertHTML":case"insertText":this.editor.insert(t)}this.doc.updateFormatBarDebounced(this.type,this)}},{key:"className",get:function(){return"cell markdown-cell"}},{key:"type",get:function(){return"markdown"}}]),t}(s.a);t.a=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=n(10),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function(e){function t(e,n){r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return o.el.setAttribute("contentEditable","plaintext-only"),o.el.addEventListener("input",o.updatePlaceholder.bind(o)),o.el.addEventListener("paste",o.onPaste.bind(o)),o}return o(t,e),a(t,[{key:"className",get:function(){return"title"}},{key:"type",get:function(){return"title"}}]),a(t,[{key:"render",value:function(){return this.el.textContent=""===this.data||"Untitled Note"===this.data?"":this.data,this.updatePlaceholder(),this}},{key:"getData",value:function(){return this.el.textContent}},{key:"updatePlaceholder",value:function(){this.el.textContent.length>0?this.el.classList.remove("placeholder"):(this.el.textContent="",this.el.classList.add("placeholder"))}},{key:"onPaste",value:function(e){e.preventDefault();var t=e.clipboardData.getData("text/plain");t=t.replace(/(\r\n|\n|\r)/gm," ").trim(),t.length>0&&this.el.classList.remove("placeholder"),document.execCommand("insertText",!1,t)}},{key:"onKeydown",value:function(e){switch(e.which){case 9:case 13:e.preventDefault(),this.doc.focusFirstCell();break;case 39:case 40:this.cursorIsAtEnd()&&(this.doc.focusFirstCell(),e.preventDefault());break;case 27:NativeApp.escapeNote(),e.preventDefault()}}}]),t}(s.a);t.a=l},,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(12),i=n(5),o=n(2);document.addEventListener("DOMContentLoaded",function(){return NativeApp.onDOMReady()}),window.loadContent=function(e,t,n,i){window.doc&&window.doc.saveContent(),window.doc&&window.doc.destroy(),window.doc=new r.a(e,t,n,i),doc.render(),window.scrollTo(0,0)},window.loadSettings=function(e){window.settings=JSON.parse(e),document.getElementById("user-css").innerHTML=settings["editor-css"],o.a(settings.editorScrollPastEnd),window.addEventListener("resize",function(){return o.a(settings.editorScrollPastEnd)})},window.updateSettings=function(e){var t=JSON.parse(e),n=function(e){var n=t[e];switch(settings[e]=n,e){case"editorScrollPastEnd":o.a(n);break;case"codeCellShowLineNumbers":doc.cells.filter(function(e){return"code"===e.type}).forEach(function(e){return e.editor.renderer.setShowGutter(n)});break;case"codeCellShowInvisibles":doc.cells.filter(function(e){return"code"===e.type}).forEach(function(e){return e.editor.setShowInvisibles(n)});break;case"codeCellShowIndentGuides":doc.cells.filter(function(e){return"code"===e.type}).forEach(function(e){return e.editor.setDisplayIndentGuides(n)});break;case"codeCellTabSize":doc.cells.filter(function(e){return"code"===e.type}).forEach(function(e){return e.editor.getSession().setTabSize(n)});break;case"codeCellUseSoftTabs":doc.cells.filter(function(e){return"code"===e.type}).forEach(function(e){return e.editor.getSession().setUseSoftTabs(n)});break;case"codeCellKeyBinding":doc.cells.filter(function(e){return"code"===e.type}).forEach(function(e){e.keybinding=n,e.editor.setKeyboardHandler(i.a[n],e.addExtraKeys)});break;case"codeCellTheme":doc.cells.filter(function(e){return"code"===e.type}).forEach(function(e){return e.editor.setTheme("ace/theme/"+n)});break;case"markdownCellTheme":doc.cells.filter(function(e){return["markdown","latex","diagram"].indexOf(e.type)>-1}).forEach(function(e){return e.editor.setTheme("ace/theme/"+n)});break;case"markdownCellTabSize":doc.cells.filter(function(e){return"markdown"===e.type}).forEach(function(e){return e.editor.getSession().setTabSize(n)});break;case"markdownCellUseSoftTabs":doc.cells.filter(function(e){return"markdown"===e.type}).forEach(function(e){return e.editor.getSession().setUseSoftTabs(n)});break;case"markdownCellKeyBinding":doc.cells.filter(function(e){return"markdown"===e.type}).forEach(function(e){e.keybinding=n,e.editor.setKeyboardHandler(i.a[n],e.addExtraKeys)});break;case"latexCellTabSize":doc.cells.filter(function(e){return"latex"===e.type}).forEach(function(e){return e.editor.getSession().setTabSize(n)});break;case"latexCellUseSoftTabs":doc.cells.filter(function(e){return"latex"===e.type}).forEach(function(e){return e.editor.getSession().setUseSoftTabs(n)});break;case"latexCellKeyBinding":doc.cells.filter(function(e){return"latex"===e.type}).forEach(function(e){e.keybinding=n,e.editor.setKeyboardHandler(i.a[n],e.addExtraKeys)});break;case"editor-css":document.getElementById("user-css").innerHTML=n}};for(var r in t)n(r)},window.loadThemeCSS=function(e,t){document.body.className=e,document.getElementById("theme-css").innerHTML=t},window.applyOp=function(e,t){return doc.applyOp(JSON.parse(e),{save:t})}}]);